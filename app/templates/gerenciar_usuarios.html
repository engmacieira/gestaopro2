{% extends "base.html" %}

{% block title %}Gerenciar Usuários - GestãoPRO{% endblock %}

{% block content %}
<header class="main-header">
    <h1>Gerenciar Usuários</h1>
    <p class="subtitle">Adicione, edite, ative/inative ou redefina senhas dos usuários do sistema.</p>
</header>

<div class="card full-width">
    {# 1. INCLUSÃO DO COMPONENTE DO CABEÇALHO DA TABELA (Já verificado) #}
    {% include '_usuarios_table_header.html' %}

    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Usuário</th>
                    <th>Nível de Acesso</th>
                    <th>Status</th>
                    <th style="width: 30%;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% if usuarios %} {# Adicionado if para caso a lista esteja vazia #}
                    {% for usuario in usuarios %}
                    <tr class="{{ 'inactive-row' if not usuario.ativo }}"> {# Adicionado classe para inativos #}
                        <td><strong>{{ usuario.username }}</strong></td>
                        <td>
                            {% if usuario.nivel_acesso == 1 %}Admin
                            {% elif usuario.nivel_acesso == 2 %}Usuário Completo
                            {% else %}Visualização
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-badge {{ 'green' if usuario.ativo else 'gray' }}">
                                {{ 'Ativo' if usuario.ativo else 'Inativo' }}
                            </span>
                        </td>
                        <td class="actions-cell">
                            {# Onclick mantido, chama JS #}
                            <button class="btn-link-action" onclick="abrirModalParaEditar({{ usuario.id }})"><i class="fa-solid fa-pencil"></i> Editar</button>
                            <button class="btn-link-action" onclick="resetarSenha({{ usuario.id }})"><i class="fa-solid fa-key"></i> Redefinir Senha</button>
                            {# Passa o status booleano para a função JS #}
                            <button class="btn-link-action {{ 'red' if usuario.ativo else 'green' }}" onclick="toggleUserStatus({{ usuario.id }}, {{ 'true' if usuario.ativo else 'false' }})">
                                <i class="fa-solid fa-power-off"></i> {{ 'Inativar' if usuario.ativo else 'Ativar' }}
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                     <tr><td colspan="4"><div class="empty-state mini"><p>Nenhum usuário encontrado.</p></div></td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

{# 2. INCLUSÃO DO COMPONENTE MODAL (Já verificado) #}
{% include '_modal_gerenciar_usuarios.html' %}
{% endblock %}

{% block scripts %}
{# Bloco de scripts agora apenas inclui o ficheiro externo #}
<script src="{{ request.app.url_path_for('static', path='js/gerenciar_usuarios.js') }}" defer></script>
{% endblock %}