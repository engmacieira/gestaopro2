{% extends "relatorios_base.html" %}

{% block relatorio_title %}AOCS Nº {{ aocs.numero_aocs }}{% endblock %}

{% block unidade_requisitante %}{{ aocs.unidade_requisitante }}{% endblock %}

{% block relatorio_content %}
    <div class="title">
        AUTORIZAÇÃO PARA EMISSÃO DE ORDEM DE COMPRA/SERVIÇO - Nº {{ aocs.numero_aocs }}
    </div>

    <div class="section-box">
        <div class="section-title">I – HISTÓRICO / DESTINO DA COMPRA / JUSTIFICATIVA</div>
        <p>{{ aocs.justificativa }}</p>
    </div>

    <div class="section-box">
        <div class="section-title">II – NÚMERO DO INSTRUMENTO CONTRATUAL</div>
        <p>{{ aocs.instrumento_contratual }}</p>
    </div>

    <div class="section-box">
        <div class="section-title">III – FORNECEDOR / CNPJ</div>
        <table>
            <tr>
                <td style="width: 70%;"><strong>Razão Social:</strong> {{ aocs.fornecedor }}</td>
                <td><strong>CNPJ:</strong> {{ aocs.cnpj }}</td>
            </tr>
        </table>
    </div>
    
    <div class="section-box">
        <div class="section-title">IV – RELAÇÃO DOS ITENS</div>
        <table class="items-table">
            <thead>
                <tr>
                    <th style="width: 8%;">ITEM</th>
                    <th class="item-description">DESCRIÇÃO</th>
                    <th style="width: 8%;">UN.</th>
                    <th style="8%;" class="text-right">QTDE</th>
                    <th style="15%;" class="text-right">VALOR UNIT. (R$)</th>
                    <th style="15%;" class="text-right">VALOR TOTAL (R$)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in itens %}
                <tr>
                    <td>{{ item.numero_item_contrato }}</td>
                    <td class="item-description">{{ item.descricao }}</td>
                    <td>{{ item.unidade_medida }}</td>
                    {# FORMATO: Formata a quantidade para 3 casas decimais (padrão de precisão) e exibe à direita #}
                    <td class="text-right">{{ "%.3f"|format(item.quantidade_pedida)|replace('.', ',') }}</td>
                    {# FORMATO: Valor unitário em 2 casas, alinhado à direita #}
                    <td class="text-right">{{ "%.2f"|format(item.valor_unitario)|replace('.', ',') }}</td>
                    {# FORMATO: Valor total em 2 casas, alinhado à direita #}
                    <td class="text-right">{{ "%.2f"|format(item.subtotal)|replace('.', ',') }}</td>
                </tr>
                {% endfor %}
                <tr class="total-row">
                    <td colspan="5" class="text-right"><strong>VALOR TOTAL</strong></td>
                    <td class="text-right"><strong>R$ {{ "%.2f"|format(total_geral)|replace('.', ',') }}</strong></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section-box">
        <div class="section-title">V – INFORMAÇÃO ACERCA DA DISPONIBILIDADE ORÇAMENTÁRIA/FINANCEIRA</div>
        <p>{{ aocs.info_orcamentaria }}</p>
    </div>

    <div class="section-box">
        <div class="section-title">VI – LOCAL DE ENTREGA</div>
        <p>{{ aocs.local_entrega }}</p>
    </div>

    {# Bloco de assinatura mais claro e formal #}
    <footer class="footer">
        <div class="signature-section" style="display: block; text-align: center;">
            {# Data e local fora do bloco de assinatura, para alinhamento central #}
            <p style="margin-bottom: 2cm;"><strong>Local e data:</strong> {{ aocs.local_data }}</p> 
            
            <div class="signature-block" style="width: 60%; margin: 0 auto; text-align: center;">
                <div class="line" style="border-top: 1px solid #333; margin-bottom: 5px;"></div>
                <p>{{ aocs.agente_responsavel }}<br><strong style="font-size: 10pt;">Assinatura do Demandante</strong></p>
            </div>
        </div>
    </footer>
{% endblock %}