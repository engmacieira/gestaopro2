{# Componente: templates/_pedido_ci_section.html #}

<div class="card">
    <h4>Comunicações Internas (CI)</h4>

    {% if cis_pagamento %}
    <div class="table-wrapper condensed-table" style="margin-bottom: 15px;">
        <table class="data-table">
            <thead>
                <tr>
                    <th style="width: 35%;">Número</th>
                    <th style="width: 20%;">Data</th>
                    <th style="width: 25%;" class="text-right">Valor</th>
                    <th style="width: 20%; text-align: right;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for ci in cis_pagamento %}
                <tr>
                    <td><strong>{{ ci.numero_ci }}</strong></td>
                    <td>{{ ci.data_ci.strftime('%d/%m/%y') if ci.data_ci else 'N/D' }}</td> {# Adicionado if para segurança #}
                    {# Formatação para moeda (duas casas decimais e vírgula) #}
                    <td class="text-right">{{ "%.2f"|format(ci.valor_nota_fiscal)|replace('.', ',') if ci.valor_nota_fiscal else '0,00' }}</td> {# Adicionado if para segurança #}
                    <td class="actions-cell" style="text-align: right;">
                        {# Ícones com links diretos - url_for alterado #}
                        <a href="{{ request.app.url_path_for('imprimir_ci', id_ci=ci.id) }}" class="btn-link-action" title="Imprimir CI" target="_blank"><i class="fa-solid fa-print"></i></a>
                        <a href="{{ request.app.url_path_for('editar_ci_ui', id_ci=ci.id) }}" class="btn-link-action" title="Editar CI"><i class="fa-solid fa-pencil"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state mini" style="padding-bottom: 15px;"><p>Nenhuma CI registrada.</p></div>
    {% endif %}

    {# Botão Nova CI - url_for alterado #}
    <div class="card-actions" style="justify-content: flex-end; margin-top: 5px; margin-bottom: 0;">
         <a href="{{ request.app.url_path_for('nova_ci_ui', numero_aocs=aocs.numero_aocs) }}" class="btn btn-primary btn-full-width"><i class="fa-solid fa-plus"></i> Nova CI</a>
    </div>
</div>